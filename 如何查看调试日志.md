# 如何查看百度API调试日志

## 日志输出位置

调试日志会输出到**两个地方**：

### 1. 日志文件（推荐）

**文件路径**：`project_log/project.log`

这是主要的日志文件，包含所有详细的调试信息。

### 2. 控制台输出

如果Flask应用在调试模式下运行，完整的API返回JSON也会打印到**终端/命令行控制台**。

## 查看日志文件的方法

### 方法1：使用文本编辑器

1. 打开文件：`project_log/project.log`
2. 滚动到文件末尾（最新的日志在最后）
3. 搜索关键词：`【调试】`、`【错误】`、`【成功】`、`【重要】`

### 方法2：使用命令行（Windows PowerShell）

```powershell
# 查看最后100行日志
Get-Content project_log\project.log -Tail 100

# 搜索包含"百度API"的日志
Select-String -Path project_log\project.log -Pattern "百度API"

# 搜索包含"Raw Response"的日志（完整JSON）
Select-String -Path project_log\project.log -Pattern "Raw Response" -Context 0,50
```

### 方法3：使用命令行（Linux/Mac）

```bash
# 查看最后100行日志
tail -n 100 project_log/project.log

# 搜索包含"百度API"的日志
grep "百度API" project_log/project.log

# 查看完整的API返回JSON（搜索Raw Response后的内容）
grep -A 50 "Raw Response" project_log/project.log
```

## 日志格式说明

日志使用以下标记来区分不同类型的信息：

- `【调试】` - 调试信息，显示执行流程
- `【错误】` - 错误信息，需要关注
- `【成功】` - 成功信息
- `【警告】` - 警告信息
- `【信息】` - 一般信息
- `【重要】` - 重要信息（如完整的API返回JSON）

## 关键日志内容

### 1. Access Token获取日志

查找包含以下内容的日志：
```
【调试】开始获取Access Token...
【调试】Token响应状态码: 200
【成功】Access Token获取成功!
```

如果看到错误码110或111：
```
【错误】错误码: 110
【错误】Access Token获取失败: API Key无效或已过期
```

### 2. API调用日志

查找包含以下内容的日志：
```
【调试】开始调用百度物体检测API...
【调试】API端点: https://aip.baidubce.com/rest/2.0/image-classify/v1/object_detect
【调试】使用的API: 百度智能云 - 物体检测API (object_detect)
```

### 3. 完整的API返回JSON（最重要）

查找包含以下内容的日志：
```
================================================================================
【重要】百度API返回的完整原始JSON数据 (Raw Response):
================================================================================
{
  "error_code": 0,
  "result": [...]
}
================================================================================
```

这部分会显示API实际返回的**完整JSON数据**，包括：
- 是否有 `error_code` 字段
- 如果有错误，错误码和错误信息是什么
- 返回的数据结构是什么样的
- 是否有尺寸相关的字段

### 4. 数据解析日志

查找包含以下内容的日志：
```
【调试】分析API返回的数据结构...
【调试】返回数据的顶级键: ['result', 'error_code']
【调试】尝试从不同位置提取物体数据...
【调试】尝试从API返回中提取房间尺寸...
```

## 常见问题排查

### 问题1：Access Token获取失败

**查看日志**：搜索 `【错误】获取access_token失败`

**可能原因**：
- API Key或Secret Key配置错误
- 错误码110：API Key无效
- 错误码111：Secret Key无效

**解决方法**：检查 `.env` 文件中的配置

### 问题2：API返回错误码

**查看日志**：搜索 `【错误】检测到错误码`

**常见错误码**：
- 110/111：Token问题
- 100：参数错误
- 282000-282005：API调用错误

### 问题3：API成功但无尺寸数据

**查看日志**：
1. 搜索 `【重要】百度API返回的完整原始JSON数据`
2. 查看返回的JSON结构
3. 检查是否有 `length`、`width`、`room_length`、`room_width` 等字段

**如果API确实不返回尺寸**：
- 这是正常的，物体检测API只返回物体信息
- 需要使用其他API或手动输入

## 快速查看最新日志

运行应用后，上传一张图片，然后：

1. **立即查看日志文件末尾**：
   ```powershell
   # Windows
   Get-Content project_log\project.log -Tail 200 -Wait
   
   # Linux/Mac
   tail -f project_log/project.log
   ```

2. **搜索关键信息**：
   - 搜索 `Raw Response` 查看完整API返回
   - 搜索 `error_code` 查看是否有错误
   - 搜索 `【成功】` 查看成功信息

## 提供调试信息

如果需要我帮您分析问题，请提供：

1. **完整的API返回JSON**（搜索 `Raw Response` 后的内容）
2. **任何错误信息**（搜索 `【错误】`）
3. **Token获取日志**（搜索 `Access Token`）

将这些信息复制给我，我可以帮您分析问题所在。
